<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta name="generator" content="Zola" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://registry.npmmirror.com/" crossorigin />
    <link rel="dns-prefetch" href="https://registry.npmmirror.com/" />
    {% set resolved_title = page.title | default(value=config.title) %} {% set
    resolved_description = page.description | default(value=config.description)
    %} {% set resolved_keywords = page.extra.keywords |
    default(value=config.extra.keywords) %}
    <title>{{ resolved_title | safe }}</title>
    <meta name="description" content="{{ resolved_description | safe }}" />
    <meta name="keywords" content="{{ resolved_keywords | safe }}" />
    <meta name="author" content="{{ config.author }}" />
    <meta name="robots" content="index, follow" />
    <meta property="og:title" content="{{ resolved_title | safe }}" />
    <meta
      property="og:description"
      content="{{ resolved_description | safe }}"
    />
    <meta property="og:image" content="/favicon.ico" />
    <meta property="og:url" content="https://tb.saop.cc/" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="{{ config.extra.site_name }}" />
    <meta property="og:locale" content="{{ config.default_language }}" />
    <link
      rel="alternate"
      type="application/rss+xml"
      href="{{ config.base_url }}/rss.xml"
      title="{{ config.title }}"
    />
    <link
      rel="stylesheet"
      href="{{ get_url(path='site.css') }}"
      fetchpriority="high"
    />
    <script
      src="https://registry.npmmirror.com/quicklink/latest/files/dist/quicklink.umd.js"
      importance="high"
    ></script>
    <script
      async
      src="https://registry.npmmirror.com/pace-js/latest/files/pace.min.js"
      importance="high"
    ></script>
    <link
      rel="stylesheet"
      href="https://registry.npmmirror.com/pace-js/latest/files/themes/blue/pace-theme-flash.css"
      importance="high"
    />
    <link
      rel="stylesheet"
      href="https://registry.npmmirror.com/animate.css/latest/files/animate.min.css"
      fetchpriority="high"
    />
    <link
      rel="stylesheet"
      href="https://registry.npmmirror.com/artalk/latest/files/dist/Artalk.css"
      fetchpriority="low"
    />
    <link
      rel="stylesheet"
      href="https://registry.npmmirror.com/lightgallery/latest/files/css/lightgallery.css"
      fetchpriority="low"
    />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  </head>

  <body>
    <header>
      <a class="header__logo white" href="/"
        ><img src="/favicon.ico" alt="logo" loading="lazy"
      /></a>
      <nav>
        <ul>
          <li><a href="/guide/">指南</a></li>
          <li><a href="/faq/">问答</a></li>
          <li><a href="/bbs/">社群</a></li>
          <li><a href="/kb/">卡硬</a></li>
          <li><a href="/about/">关于</a></li>
        </ul>
      </nav>
    </header>
    <main class="content animate__animated animate__fadeIn">
      <turbo-frame>{% block content %} {% endblock content %}</turbo-frame>
      <turbo-frame>
        <div id="Comments"></div>
      </turbo-frame>
    </main>
    <footer>
      <script src="https://unpkg.com/tiny-segmenter/dist/tiny-segmenter-0.2.0.js"></script>
      <script type="module">
        import { search, default as init } from "/wasm/tinysearch_engine.js";
        window.search = search;

        async function initSearch() {
          try {
            // 预加载 JSON 数据
            const response = await fetch("/search_index_processed.json");
            if (!response.ok)
              throw new Error(`Failed to load JSON: ${response.status}`);
            const jsonData = await response.json();
            console.log("JSON loaded:", jsonData);
            await init("/wasm/tinysearch_engine_bg.wasm");
            console.log("Tinysearch initialized successfully");
          } catch (error) {
            console.error("Failed to initialize Tinysearch:", error);
            document.getElementById("search").disabled = true;
            document.getElementById("results").innerHTML =
              "<li>搜索功能加载失败，请稍后重试</li>";
          }
        }
        initSearch();
      </script>
      <script>
        const segmenter = new TinySegmenter();
        const searchInput = document.getElementById("search");
        const resultsList = document.getElementById("results");

        function doSearch() {
          const value = searchInput.value.trim();
          if (!value) {
            resultsList.innerHTML = "";
            return;
          }

          const query = segmenter.segment(value).join(" ");
          console.log("Search query:", query); // 调试分词结果
          try {
            const results = window.search(query, 10);
            resultsList.innerHTML = "";
            if (results.length === 0) {
              resultsList.innerHTML = "<li>未找到匹配结果</li>";
              return;
            }
            results.forEach(([title, url]) => {
              const li = document.createElement("li");
              const link = document.createElement("a");
              link.textContent = title;
              link.href = url;
              li.appendChild(link);
              resultsList.appendChild(li);
            });
            resultsList.classList.add("animate__animated", "animate__fadeIn");
          } catch (error) {
            console.error("Search error:", error);
            resultsList.innerHTML = "<li>搜索出错，请稍后重试</li>";
          }
        }

        let debounceTimer;
        searchInput.addEventListener("input", () => {
          clearTimeout(debounceTimer);
          debounceTimer = setTimeout(doSearch, 300);
        });
      </script>
      <style>
        #search {
          width: 100%;
          padding: 8px;
          border: 1px solid #ccc;
          border-radius: 4px;
          font-size: 16px;
        }
        #results {
          list-style: none;
          padding: 0;
          margin-top: 10px;
        }
        #results li {
          margin: 5px 0;
        }
        #results a {
          text-decoration: none;
          color: #1a73e8;
        }
        #results a:hover {
          text-decoration: underline;
        }
      </style>
      <input type="text" id="search" placeholder="输入搜索关键词..." />
      <ul id="results"></ul>
      <turbo-frame>
        <p>
          访问：<span id="busuanzi_value_site_pv">null</span>，访客：<span
            id="busuanzi_value_site_uv"
            >null</span
          >
        </p>
      </turbo-frame>
      <p class="links">
        <a href="https://www.bilibili.com/video/BV1BG4y137mG" target="_blank"
          >装机教程</a
        >&nbsp;
        <a href="https://www.bilibili.com/video/BV1DJ411D79y" target="_blank"
          >系统安装</a
        >&nbsp;<a href="/cpu-ranking/">CPU 天梯</a>&nbsp;
        <a href="/gpu-ranking/">显卡天梯</a>&nbsp;
        <a href="/links/">友站</a>&nbsp; <a href="/sdk/">引擎</a>&nbsp;
        <a href="/update/">更新日志</a>&nbsp; <a href="/feed/">订阅</a>&nbsp;
        <a href="/sitemap.xml">站点地图</a>&nbsp; <a href="/os/">开源</a>&nbsp;
        <a href="/donate/">捐赠</a>&nbsp; <a href="/url/">永久网址</a>&nbsp;
        <a href="https://github.com/AdingApkgg/tb" target="_blank">GitHub</a>
      </p>
      <p class="copyright">
        <b>&copy; <a href="https://saop.cc" target="_blank">Asuna</a></b>
      </p>
    </footer>
    <script
      type="module"
      src="https://registry.npmmirror.com/instant.page/latest/files/instantpage.js"
    ></script>
    <script
      type="module"
      src="https://registry.npmmirror.com/@hotwired/turbo/latest/files/dist/turbo.es2017-esm.js"
    ></script>
    <script
      async
      src="https://registry.npmmirror.com/js-asuna/latest/files/js/bsz.pure.mini.js"
      fetchpriority="low"
    ></script>
    <script
      src="https://registry.npmmirror.com/lightgallery/latest/files/lightgallery.min.js"
      fetchpriority="low"
    ></script>
    <script
      src="https://registry.npmmirror.com/artalk/latest/files/dist/Artalk.js"
      fetchpriority="low"
    ></script>
    <script
      src="https://registry.npmmirror.com/@artalk/plugin-lightbox/latest/files/dist/artalk-plugin-lightbox.js"
      fetchpriority="low"
    ></script>
    <script>
      quicklink.listen({ priority: true });
      Artalk.init({
        el: "#Comments",
        pageKey: "https://tb.saop.cc",
        server: "https://artalk.saop.cc",
        site: "图吧工具",
        darkMode: true,
      });
    </script>
  </body>
</html>
